<div class="w-full mx-auto px-4 pt-4">
  <div class="flex flex-wrap justify-start gap-2 z-10">
    <button class="tab" [ngClass]="tabname == '' ? 'tab_selected' : 'tab'" (click)="changeTab('')">
      Összes
    </button>
    <button class="tab" [ngClass]="tabname == 'Digitális pénzügy' ? 'tab_selected' : 'tab'" (click)="changeTab('Digitális pénzügy')">
      Digitális pénzügy
    </button>
    <button class="tab" [ngClass]="tabname == 'Informatikai biztonság' ? 'tab_selected' : 'tab'" (click)="changeTab('Informatikai biztonság')">
      Informatikai biztonság
    </button>
    <button class="tab" [ngClass]="tabname == 'Vállalatvezetés' ? 'tab_selected' : 'tab'" (click)="changeTab('Vállalatvezetés')">
      Vállalatvezetés
    </button>
    <button class="tab" [ngClass]="tabname == 'Értékesítés és marketing' ? 'tab_selected' : 'tab'" (click)="changeTab('Értékesítés és marketing')">
      Értékesítés és marketing
    </button>
    <button class="tab" [ngClass]="tabname == 'Digitális mindennapok' ? 'tab_selected' : 'tab'" (click)="changeTab('Digitális mindennapok')">
      Digitális mindennapok
    </button>
    <button class="tab" [ngClass]="tabname == 'Digitális Jelenlét' ? 'tab_selected' : 'tab'" (click)="changeTab('Digitális Jelenlét')">
      Digitális Jelenlét
    </button>
  </div>

  <div *ngIf="isloaded" class="bg-white shadow-lg big_cont px-4 pb-8 mb-4 border-2 border-gray-100 p-4">
    <div class="mb-4 w-full md:w-1/3">
      <select [(ngModel)]="selectedValue" (change)="onSelect(selectedValue)" class="block w-full bg-gray-50 border-2 border-gray-200 text-gray-700 py-3 rounded leading-tight focus:outline-none px-4">
        <option selected [value]="'Összes'">Összes</option>
        <option [value]="'Szakma'">Tevékenységi kör</option>
        <option [value]="'Regió'">Regió</option>
        <option [value]="'Munkásszám'">Foglalkoztatottak száma</option>
      </select>
    </div>

    <div class="ml-3" *ngIf="selectedValue == 'Szakma'">Jelenleg a/az <span class="font-bold">{{myFirm.Field | firmSelectedValueToDisplayText}}</span> foglalkozó vállalkozások adatai látszanak!</div>
    <div class="ml-3" *ngIf="selectedValue== 'Regió'">Jelenleg a/az <span class="font-bold">{{myFirm.Region | firmSelectedValueToDisplayText}}</span> székhellyel rendelkező vállalkozások adatai látszanak!</div>
    <div class="ml-3" *ngIf="selectedValue== 'Munkásszám'">Jelenleg a/az <span class="font-bold">{{myFirm.Workers | firmSelectedValueToDisplayText}}</span> foglalkoztató vállalkozások adatai látszanak!</div>

    <div class="flex flex-col md:flex-row justify-center mt-10">
      <div id="piechart" class="w-full flex justify-center"></div>
      <div id="piechart2" class="w-full flex justify-center"></div>
    </div>

    <div class="space-y-4">
      <div *ngFor="let valaszopcio of currentResult.results; let i = index">
        <div *ngIf="valaszopcio.selectedAnswer.length != 0">
          
        <div class="flex flex-col md:flex-row w-full justify-between items-center mt-8 md:mt-32">
          <div class="flex flex-col w-full md:w-[30rem]">
            <span class="text-lg font-bold">{{valaszopcio.questionText}}</span>
            <span *ngIf="valaszopcio.selectedAnswerTexts.length != 0" class="mt-5">A te válaszod/válaszaid a kérdésre: <span class="font-bold">{{valaszopcio.selectedAnswerTexts}}</span></span>
            <span *ngIf="valaszopcio.selectedAnswerTexts.length == 0" class="mt-5">Erre a kérdésre nem tudtál választ adni, mivel a kérdés előfeltételei nem teljesültek.</span>
          </div>
          <div class="w-full md:w-[40rem] text-[1rem] mt-4 md:mt-0">
            <div *ngIf="valaszopcio.points >= sortedPoints[i].ShownPoint && (sortedPoints[i].ShownPoint != 0)" class="flex flex-col justify-between lg:flex-row items-center bg-white shadow-lg">
              <div class="p-5 mr-5 flex flex-col justify-between items-start">
                <span>A válaszoddal elért pontszám: <span class="font-bold">{{valaszopcio?.points}} pont</span> / <span class="font-bold">{{(valaszopcio.points | rounder:valaszopcio.maxpoint)}}</span></span>
                <span class="mt-2">A többi cég átlagos pontszáma: <span class="font-bold">{{sortedPoints[i].ShownPoint | number:'1.0-1'}} pont</span> / <span class="font-bold">{{ (sortedPoints[i].ShownPoint |rounder:valaszopcio.maxpoint)}}</span></span>
                <span class="mt-2">Ez számodra egy jó eredménynek számít!</span>
              </div>
              <img src="assets/ai_trans.png" class="w-28 rounded-full" alt="">
            </div>
            <div *ngIf="valaszopcio.points < sortedPoints[i].ShownPoint && (sortedPoints[i].ShownPoint != 0)" class="flex flex-col justify-between lg:flex-row items-center  bg-white shadow-lg p-5 rounded-md">
              <div class="p-5 mr-5 flex flex-col justify-between items-start">
                <span>A válaszoddal elért pontszám: <span class="font-bold">{{valaszopcio?.points }} pont</span> / <span class="font-bold">{{(valaszopcio.points | rounder:valaszopcio.maxpoint)}}</span></span>
                <span class="mt-2">A többi cég átlagos pontszáma: <span class="font-bold">{{sortedPoints[i].ShownPoint | number:'1.0-1'}} pont</span> / <span class="font-bold">{{ (sortedPoints[i].ShownPoint |rounder:valaszopcio.maxpoint)}}</span></span>
                <span class="mt-2"> Ez számodra egy nem jó eredmény, ebben a témában van még hova fejlődni..</span>
              </div>
              <img src="assets/ai_not_happy.png" class="w-28 rounded-full" alt="">
            </div>
            <div *ngIf="sortedPoints[i].ShownPoint == 0" class="flex items-end">
              <div class=" mr-5 flex flex-col justify-start items-start">
                <span>A válaszoddal elért pontszám: <span class="font-bold">{{valaszopcio?.points}} pont</span> / <span class="font-bold">{{(valaszopcio.points / valaszopcio.maxpoint)}}</span></span>
                <span class="mt-2">Sajnos más cégekről nincs eredményünk.</span>
              </div>
              <img src="assets/ai_trans.png" class="w-28 rounded-full" alt="">
            </div>
          </div>
        </div>
        <div [ngClass]="sortedPoints[i].ShownPoint == 0 ? 'hidden' : 'block'" class="w-full md:w-1/2 mx-auto mt-10">
          <div [id]="'chart' +  i"></div>
        </div>
      </div>
      </div>
      <p class="text-center">Vannak olyan kérdések amelyek nem jelentek meg a kérdőívben, mivel előfeltételeik nem teljesültek. Ezekre a kérdésekre automatikusan 0 pont jár.</p>
    </div>
  </div>
</div>

<div class="app-container" (document:click)="onDocumentClick($event)">
  <div class="chat-container" [class.hidden]="!isChatVisible">
    <div class="chat-header">
      <span class="ml-2">
        DIGIMÉTER
      </span>
      <button class="close-button mr-2" (click)="isChatVisible = false">×</button>
    </div>
    <div class="messages flex-grow overflow-y-auto p-2">
      <div *ngFor="let message of messages" class="message"
        [ngClass]="{'user bg-gray-300': message.user, 'bot bg-blue-500 text-white': !message.user}">
        {{ message.text }}
      </div>
      <div class="loader" *ngIf="isMessageLoading">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
    <input type="text" [(ngModel)]="inputText" (keyup.enter)="sendMessage()" placeholder="Írj valamit..."
      class="p-2 border-t border-gray-300">
  </div>
  <button
    class="chat-button fixed bottom-4 left-4 w-16 h-16 rounded-full bg-blue-500 flex items-center justify-center overflow-hidden transition-transform transform hover:scale-110 border-2 border-white"
    (click)="toggleChat($event)">
    <img src="assets/ai.png" alt="Chat" class="w-full h-full object-cover">
  </button>
</div>